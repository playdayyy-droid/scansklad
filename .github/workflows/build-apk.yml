steps:
  - name: Checkout
    uses: actions/checkout@v4

  - name: Setup Java
    uses: actions/setup-java@v4
    with:
      distribution: temurin
      java-version: "17"

  - name: Setup Flutter
    uses: subosito/flutter-action@v2
    with:
      flutter-version: "3.22.2"
      channel: "stable"

  - name: Flutter pub get
    run: flutter pub get
  - name: Ensure Android project exists
    run: |
      if [ ! -d "android" ]; then
        flutter create . --platforms=android
      fi

  # ВАЖНО: создаём android-проект, если его нет в репозитории
  - name: Ensure Android project exists
    run: |
      if [ ! -d "android" ]; then
        flutter create . --platforms=android
      fi

  - name: Build APK (debug)
    run: flutter build apk --debug

  - name: Upload APK artifact
    uses: actions/upload-artifact@v4
    with:
      name: app-debug
      path: build/app/outputs/flutter-apk/app-debug.apk
